# 英语听力训练应用 - 生产环境配置模板
# 复制此文件为 .env.production 并根据实际环境修改配置

# ================================
# 应用基础配置
# ================================

# 应用运行环境
NODE_ENV=production

# 应用端口（默认 3000）
PORT=3000

# 应用域名（用于生成绝对 URL）
NEXT_PUBLIC_APP_URL=https://your-domain.com

# ================================
# JWT 认证配置（必需）
# ================================

# JWT 密钥 - 必须是强随机字符串
# 生成方法: openssl rand -hex 32
JWT_SECRET=your-strong-jwt-secret-here-change-this-in-production

# JWT Token 过期时间（可选，不设置则不过期，支持"记住我"功能）
# JWT_EXPIRES_IN=7d

# ================================
# 数据库配置
# ================================

# 数据库连接 URL
DATABASE_URL=file:./data/app.db

# 数据库类型（sqlite/postgresql/mysql）
DATABASE_TYPE=sqlite

# PostgreSQL 配置（如果使用）
# DB_HOST=localhost
# DB_PORT=5432
# DB_NAME=listening_training
# DB_USER=postgres
# DB_PASSWORD=your-password

# MySQL 配置（如果使用）
# DB_HOST=localhost
# DB_PORT=3306
# DB_NAME=listening_training
# DB_USER=mysql_user
# DB_PASSWORD=your-password

# ================================
# AI 服务配置（必需）
# ================================

# Cerebras AI API 密钥 - 必需
CEREBRAS_API_KEY=your_cerebras_api_key_here

# AI 服务超时时间（毫秒，默认 30000）
AI_TIMEOUT=30000

# AI 模型配置
AI_MODEL=llama3.1-8b

# ================================
# TTS 服务配置
# ================================

# PyTorch MPS 支持（Apple Silicon Mac，Linux 服务器设置为 0）
PYTORCH_ENABLE_MPS_FALLBACK=0

# TTS 服务超时时间（毫秒）
TTS_TIMEOUT=120000

# TTS 音频质量（low/medium/high）
TTS_QUALITY=medium

# TTS 模型预热（true/false）
TTS_WARMUP=true

# ================================
# GPU 和 CUDA 配置（生产环境）
# ================================

# GPU 设备选择（cuda/cpu/mps）
KOKORO_DEVICE=cuda

# NVIDIA GPU 可见性（all 表示所有 GPU）
NVIDIA_VISIBLE_DEVICES=all

# CUDA 设备选择（0 表示第一块 GPU，多 GPU 可用逗号分隔如 0,1）
CUDA_VISIBLE_DEVICES=0

# TTS 最大并发数（Tesla P40 24GB 显存建议 4-6，根据实际负载调整）
KOKORO_TTS_MAX_CONCURRENCY=4

# Python 虚拟环境路径
KOKORO_VENV=/app/kokoro-local/venv

# Python 模块搜索路径
PYTHONPATH=/app/kokoro-main-ref:/app/kokoro-main-ref/kokoro.js

# PyTorch CUDA 内存分配配置（优化显存使用）
PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512

# ================================
# 管理员账户配置
# ================================

# 默认管理员邮箱
ADMIN_EMAIL=admin@yourdomain.com

# 默认管理员密码（首次启动时创建，请及时修改）
ADMIN_PASSWORD=ChangeThisPassword123!

# 默认管理员姓名
ADMIN_NAME=System Administrator

# ================================
# 网络和代理配置
# ================================

# HTTP 代理（如需要访问外部 API）
# PROXY_URL=http://your-proxy-server:8080

# HTTPS 代理
# HTTPS_PROXY=http://your-proxy-server:8080

# 不使用代理的地址
# NO_PROXY=localhost,127.0.0.1,.local

# ================================
# 备份配置
# ================================

# 备份保留天数
BACKUP_RETENTION_DAYS=7

# 备份存储路径
BACKUP_PATH=/app/backups

# 启用远程备份
REMOTE_BACKUP=false

# S3 备份配置（可选）
# S3_BUCKET=your-backup-bucket
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key
# AWS_REGION=us-east-1

# FTP 备份配置（可选）
# FTP_HOST=ftp.yourserver.com
# FTP_USER=backup_user
# FTP_PASS=backup_password

# ================================
# 日志配置
# ================================

# 日志级别（error/warn/info/debug）
LOG_LEVEL=info

# 日志文件路径
LOG_FILE=/app/logs/app.log

# 错误日志路径
ERROR_LOG=/app/logs/error.log

# 访问日志路径
ACCESS_LOG=/app/logs/access.log

# 日志轮转大小（MB）
LOG_MAX_SIZE=10

# 保留日志文件数量
LOG_MAX_FILES=10

# ================================
# 安全配置
# ================================

# CORS 允许的域名（逗号分隔）
CORS_ORIGINS=https://your-domain.com,https://www.your-domain.com

# 会话 Cookie 配置
COOKIE_SECURE=true
COOKIE_SAME_SITE=strict
COOKIE_HTTP_ONLY=true

# 内容安全策略
CSP_ENABLED=true

# 速率限制配置
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# ================================
# 性能优化配置
# ================================

# 静态文件缓存时间（秒）
STATIC_CACHE_MAX_AGE=31536000

# API 响应缓存时间（秒）
API_CACHE_MAX_AGE=300

# 数据库连接池大小
DB_POOL_SIZE=5

# 工作进程数量（0 表示 CPU 核心数）
WORKER_PROCESSES=0

# ================================
# 监控和诊断配置
# ================================

# 启用健康检查端点
HEALTH_CHECK_ENABLED=true

# 启用性能监控
PERFORMANCE_MONITORING=true

# 启用错误报告
ERROR_REPORTING=true

# Sentry DSN（错误监控，可选）
# SENTRY_DSN=https://your-sentry-dsn

# 启用数据库查询日志
DB_QUERY_LOG=false

# ================================
# 开发和调试配置（生产环境建议关闭）
# ================================

# 启用调试模式
DEBUG=false

# 启用详细日志
VERBOSE_LOGGING=false

# 启用 API 调试信息
API_DEBUG=false

# ================================
# 系统资源配置
# ================================

# Node.js 内存限制（MB）
NODE_OPTIONS=--max-old-space-size=2048

# 文件上传大小限制（MB）
MAX_FILE_SIZE=50

# 请求体大小限制（MB）
MAX_BODY_SIZE=10

# 会话超时时间（毫秒）
SESSION_TIMEOUT=3600000

# ================================
# 第三方服务配置（可选）
# ================================

# Redis 配置（如果使用缓存）
# REDIS_URL=redis://localhost:6379
# REDIS_PASSWORD=your-redis-password

# ElasticSearch 配置（如果使用搜索）
# ELASTICSEARCH_URL=http://localhost:9200

# 邮件服务配置（如果需要发送邮件）
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your-email@gmail.com
# SMTP_PASS=your-app-password
# SMTP_SECURE=true

# ================================
# 特殊功能配置
# ================================

# 启用音频文件自动清理
AUDIO_CLEANUP_ENABLED=true
AUDIO_CLEANUP_DAYS=7

# 启用用户数据统计
USER_ANALYTICS=true

# 启用练习记录统计
PRACTICE_ANALYTICS=true

# 最大并发 TTS 请求数
MAX_CONCURRENT_TTS=3

# ================================
# 部署相关配置
# ================================

# 部署环境标识
DEPLOYMENT_ENV=production

# 应用版本（自动填充）
# APP_VERSION=1.0.0

# 构建时间（自动填充）
# BUILD_TIME=2024-08-29T12:00:00Z

# Git 提交哈希（自动填充）
# GIT_COMMIT=abc1234

# ================================
# 配置说明和安全提醒
# ================================

# 重要安全提醒：
# 1. 请务必修改所有包含 "change-this" 或 "your-" 的配置项
# 2. JWT_SECRET 必须使用强随机字符串，不要使用默认值
# 3. 管理员密码必须强密码，首次登录后立即修改
# 4. 生产环境请启用 HTTPS 和相关安全配置
# 5. 定期更新 API 密钥和密码
# 6. 不要将此文件提交到版本控制系统

# 性能优化建议：
# 1. 根据服务器规格调整内存限制和工作进程数
# 2. 启用适当的缓存策略
# 3. 定期清理临时文件和日志
# 4. 监控系统资源使用情况

# 备份和恢复：
# 1. 定期运行备份脚本：./scripts/backup.sh
# 2. 测试恢复流程：./scripts/restore.sh
# 3. 配置远程备份以防数据丢失
# 4. 保留多个备份版本

# 监控和维护：
# 1. 定期检查应用健康状态：./scripts/health-check.sh
# 2. 监控日志文件中的错误和警告
# 3. 定期更新依赖包和系统组件
# 4. 设置告警机制用于生产环境监控